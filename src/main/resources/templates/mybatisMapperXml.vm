<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="${basePath}.mapper.${className}Mapper">
## ##用来取消换行
#macro(jdbcTypeHandler $dataType)
 #if($dataType == "DATETIME")
jdbcType="TIMESTAMP" ##
 #elseif($dataType == "INT")
jdbcType="INTEGER"
 #else
jdbcType="$dataType" ##
 #end
 #end


    <resultMap id="BaseResultMap" type="${basePath}.entity.${className}">
        #foreach($field in $fields)
            #if($field.attributeName && $field.attributeName == "id")
                <id property="id" column="id" jdbcType="BIGINT"/>
            #else
                <result property="${field.attributeName}" column="${field.columnName}" #jdbcTypeHandler($field.upperCaseDataType)/>
            #end
        #end
    </resultMap>

    <sql id="Base_Column_List">
        #foreach($field in $fields)
            #set($column = $field.columnName.trim())  ${column}#if($foreach.hasNext),#end##
            #if($foreach.index % 3 == 2 && $foreach.hasNext)

            #end
        #end
        #if( 1==1)

        #end
    </sql>
    #if(  $serverMethods.contains("list") )
        <select id="getList" resultType="BaseResultMap">
            select
            <include refid="Base_Column_List"/>
            from ${tableName}
            <where>
                <if test="${className}.creater != null">
                    and creater = #{${className}.creater}
                </if>
            </where>
        </select>
    #end

    #if(  $serverMethods.contains("add") )
        <insert id="add" parameterType="${basePath}.entity.${className}">
            insert into ${tableName}(#foreach ($field in $fields) ${field.columnName}#if($foreach.hasNext),#end#end)
            values (#foreach ($field in $fields) #{${field.attributeName}}#if($foreach.hasNext),#end #end)
        </insert>
    #end

    #if(  $serverMethods.contains("deleteById") )
        <delete id="safeDeleteById">
            delete
            from ${tableName}
            where id = #{id}
            AND creater = #{userId}
        </delete>
    #end

    #if(  $serverMethods.contains("update") )
        <update id="safeUpdate">
            update ${tableName} set
            #foreach($field in $fields)
                #if($field.attributeName && ($field.attributeName != "id" && $field.attributeName != "creater" && $field.attributeName != "update_time"))
                    ${field.columnName} = #{${field.attributeName}}#if($foreach.hasNext),#end
                #end
            #end
            where id = #{${lowerCaseClassName}Record.id}
            AND creater = #{userId}
        </update>
    #end


</mapper>
